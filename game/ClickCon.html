<!DOCTYPE html>
<head>
	<title>ClickCon!</title>
	<script src='planeto.js'></script>
	<script src='map.js'></script>
	<script src='game.js'></script>
	<script src='bot.js'></script>
	<script src='utils.js'></script>
</head>
<style>
	body {
	color:#fff;
	background-color:#000;
	font-size:30px;
	}
	span{
	width:300px;
	float:left;
	display:inline-block;
	}
	.content{
	margin:0 auto;
	display:inline-block;
</style>
<!-- <span> -->
	<!-- <form size="3"> -->
		<!-- <fieldset  id="board" > -->
		<!-- <legend>Score Box</legend> -->
		<!-- </fieldset> -->
	<!-- </form> -->
<!-- </span> -->
<!-- <span class="content" id='thingy'> -->
	<!-- <canvas id='canvas' width='1500' height='1500' onclick="checkHit(map)"></canvas> -->
<!-- </span> -->
<body>
</body>
<script>
//PUBLIC VARS
var map = [];
var canvas;
var ctx;
var zoomScale = 1;
var zoomChange = 0;
var players = [];	
var botwar = false;

var pCount = 1;
var pID = "playerNode" + pCount;
var colList = ["#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff", "#00cccc", "#e65c00", "#2e5cb8", "#800080","#663300", "#ff8080","#00802b", "#008080","#800000","#666699","#cc9900"];

startMenu();

function startMenu(){
	var divi = document.createElement("div");
	var StartBtn = document.createElement("button");
	var AplyrBtn = document.createElement("button");
	var BotWarBtn = document.createElement("button");
	var hostPlayer = document.createElement("div");
	var AbtnTxt = document.createTextNode("+ Bot");	
	var strtbtntxt = document.createTextNode("Start Game");
	var botWarBtnTxt = document.createTextNode("Bot War");
	var playerName = document.createTextNode(adjectives[Math.floor(Math.random()*adjectives.length)] + nouns[Math.floor(Math.random()*nouns.length)] + Math.floor(Math.random()*10) + Math.floor(Math.random()*10));
	
	var playerColour = Math.floor(Math.random()*colList.length);
	hostPlayer.style.color = colList[playerColour];
	colList = removeAtIndex(colList, playerColour);
	
	StartBtn.id = "StartBtn";
	divi.id = "divi";
	AplyrBtn.id = "AplyrBtn";
	hostPlayer.id = "hostPlayer";
	BotWarBtn.id = "BotWarBtn";
	
	divi.float = "center";	
	AplyrBtn.float = "left";	

	AplyrBtn.appendChild(AbtnTxt);
	hostPlayer.appendChild(playerName);
	StartBtn.appendChild(strtbtntxt);
	BotWarBtn.appendChild(botWarBtnTxt);
	divi.appendChild(hostPlayer);
	
	AplyrBtn.addEventListener("click", function(event){event.preventDefault(); addPlyr(divi, document.createElement("div"));});
	StartBtn.addEventListener("click", function(event){event.preventDefault(); gameStart();});
	BotWarBtn.addEventListener("click", function(event){event.preventDefault(); botwar = true; gameStart();});
	
	document.body.appendChild(StartBtn);
	document.body.appendChild(BotWarBtn);
	document.body.appendChild(divi);
	document.body.appendChild(AplyrBtn);
	
	addPlyr(divi, document.createElement("div"));
	addPlyr(divi, document.createElement("div"));
	addPlyr(divi, document.createElement("div"));
}
function addPlyr(parent, child){
	if(colList.length > 0){
		var name = adjectives[Math.floor(Math.random()*adjectives.length)] + nouns[Math.floor(Math.random()*nouns.length)] + Math.floor(Math.random()*10) + Math.floor(Math.random()*10);
		var tst = document.createTextNode(name);
		var killbtn = document.createElement("button");
		killbtn.id = "pnodekiller" + pCount;
		var rip = document.createTextNode("X");
		killbtn.appendChild(rip);
		killbtn.addEventListener("click", function(event){event.preventDefault(); colList.push(this.parentNode.style.color); var par = this.parentNode; par.parentNode.removeChild(par); pCount -= 1;});
		pID = "playerNode" + pCount;
		child.id = pID;
		child.appendChild(tst);
		child.appendChild(killbtn);
		child.style.color = colList[0];
		colList = removeAtIndex(colList, 0);
		parent.appendChild(child);
		pCount += 1;
	}
}
function gameStart(){
	var pName = document.getElementById("hostPlayer").innerText;
	var pCol = document.getElementById("hostPlayer").style.color;
	
	if(botwar){
		players.push(new wildExpand(pName, pCol, 1));
		for(var p = 1; p<pCount; p++){
			var elNm = "playerNode" + p;
			pName = document.getElementById(elNm).innerText;
			pName = pName.substring(0, pName.length-1);
			pCol = document.getElementById(elNm).style.color;
			var botType = Math.floor(Math.random()*2);
			var bot;
			switch (botType){
				case 0:
					bot = new wildExpand(pName, pCol, p+1);
					break;
				case 1:
					bot = new wildStep(pName, pCol, p+1);
					break;
			}
			players.push(bot);
		}
		var id = pCount + 1;
		for(var r = 0; r<colList.length; ++r){
			var botType = Math.floor(Math.random()*2);
			var bot;
			var pName = adjectives[Math.floor(Math.random()*adjectives.length)] + nouns[Math.floor(Math.random()*nouns.length)] + Math.floor(Math.random()*10) + Math.floor(Math.random()*10);
			switch (botType){
				case 0:
					bot = new wildExpand(pName, colList[r], id);
					break;
				case 1:
					bot = new wildStep(pName, colList[r], id);
					break;
			}
			id++;
			players.push(bot);
		}
	}
	else{
		players.push(new Player(pName, pCol, 1, false));
		for(var pc = 1; pc < pCount; ++pc){
		var elNm = "playerNode" + pc;
		pName = document.getElementById(elNm).innerText;
		pName = pName.substring(0, pName.length-1);
		pCol = document.getElementById(elNm).style.color;
		var botType = Math.floor(Math.random()*2);
		var bot;
		switch (botType){
			case 0:
				bot = new wildExpand(pName, pCol, pc+1);
				break;
			case 1:
				bot = new wildStep(pName, pCol, pc+1);
				break;
		}
		players.push(bot);
		}
	}

	document.getElementById("StartBtn").parentNode.removeChild(document.getElementById("StartBtn"));
	document.getElementById("BotWarBtn").parentNode.removeChild(document.getElementById("BotWarBtn"));
	document.getElementById("divi").parentNode.removeChild(document.getElementById("divi"));
	document.getElementById("AplyrBtn").parentNode.removeChild(document.getElementById("AplyrBtn"));
		
	var scoreBoxSpan = document.createElement("span");
	var canvasSpan = document.createElement("span");
	
	var scoreBox = document.createElement("form");
	var field = document.createElement("fieldset");
	var lege = document.createElement("legend");
	scoreBox.size = 3;
	field.id = "board";
	lege.innerHTML = "ScoreBox";
	field.appendChild(lege);
	scoreBox.appendChild(field);
	
	canvas = document.createElement("canvas");
	canvasSpan.class = "content";
	canvas.width = 1500;
	canvas.height = 1500;
	
	canvasSpan.appendChild(canvas);
	scoreBoxSpan.appendChild(scoreBox);
	
	document.body.appendChild(scoreBoxSpan);
	document.body.appendChild(canvasSpan);
	
	var mapPick = Math.floor(Math.random()*8);
	switch (mapPick){
		case 0: map = prettySym();
				break;
		case 1: map = scatterBlob();
				break;
		case 2: map = praiseJibbers();
				break;
		case 3: map = spiralGal();
				break;
		case 4: map = ringODeath();
				break;
		case 5: map = clusters();
				break;
		case 6: map = heartbreak();
				break;
		case 7: map = converge();
				break;
	}
	
	//map = properSpiral();
	ctx = canvas.getContext('2d');
	setCanvasDims();
	ctx.scale(zoomScale, zoomScale);
	ctx.beginPath();

	//players = [new Player("Vi", "#a3a", 1, false)];
	//players = [new wildExpand("1", "#f00", 1), new wildExpand("2", "#0f0",2), new wildExpand("3","#00f", 3),new wildExpand("4","#f0f", 4),new wildExpand("5","#0ff", 5),new wildExpand("6","#ff0", 6)];
	var spawns = Math.floor(Math.random()*(Math.floor((map.length/players.length))))+1;
	setupGame(players,map,spawns);
	render(map);
	if(botwar == false){
		canvas.onclick = function(){checkHit(map); return false;};
	}
}
function setCanvasDims(){
	console.log("Called");
	var maxY = 0;
	var maxX = 0;
	for(var v = 0; v<map.length; v++){
		if((map[v].getX()) * zoomScale > maxX){
			maxX = map[v].getX();
		}
		if((map[v].getY()) * zoomScale > maxY){
			maxY = map[v].getY();
		}
	}
	canvas.width = maxX + 100;
	canvas.height = maxY + 100;
}
</script>